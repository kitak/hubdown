#!/usr/bin/env ruby
require 'github/markdown'
require 'hubdown/cli_parser'
require 'hubdown/page_builder'

def init
  @file_name = ARGV.shift
  parser = CliParser.new
  parser.run ARGV
  mdown = create_mdown
  p = Hubdown::PageBuilder.new mdown

  if parser.config[:output] 
    p.get_page
    # write to file
    File.open( parser.config[:output], "w" ) { |f| f.write p.get_page } 
  elsif parser.config[:preview]
    p.get_page
    # push to bcat
  else
    puts mdown
  end

end

def create_mdown
  md = GitHub::Markdown.render_gfm File.read(@file_name)
  md
end

init

