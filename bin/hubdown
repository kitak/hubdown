#!/usr/bin/env ruby
require 'github/markdown'
require 'hubdown/cli_parser'
require 'hubdown/page_builder'

def init
  @file_name = ARGV.shift
  output = ""
  parser = CliParser.new
  parser.run ARGV
  mdown = create_mdown

  if parser.config[:output] || parser.config[:wrap]
    page_data = create_page mdown
    if parser.config[:output]
      File.open( parser.config[:output], "w" ) { |f| f.write page_data } 
    end
    if parser.config[:wrap]
      output = page_data
    end
  else
    output = mdown
  end

  if output != ""
    puts output
  end

end

def create_page mdown
  options = { 
    "body" => mdown, 
    "filename" => @file_name, 
    "uri" => 'https://github.com/knomedia/hubdown'
  } 
  p = Hubdown::PageBuilder.new options
  page_data = p.get_page
  page_data
end


def create_mdown
  md = GitHub::Markdown.render_gfm File.read(@file_name)
  md
end

init

